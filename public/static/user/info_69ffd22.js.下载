$(document).ready(function(){InfoUtil.checkNickname($("#j-ninkname-input"),$("#j-check-ninkname")),InfoUtil.setGradeName(),InfoUtil.modifyCollegeMajor($("#j-college-input"),$("#j-college-del"),$("#j-college-choose-list"),$("#j-check-college"),"college"),InfoUtil.modifyCollegeMajor($("#j-major-input"),$("#j-major-del"),$("#j-major-choose-list"),$("#j-check-major"),"major"),InfoUtil.choosePurpose($(".purpose_item")),$("#j-sava-btn").click(function(){$(this).hasClass("click")&&InfoUtil.savaInfo()})});var InfoUtil={};InfoUtil.checkNickname=function(e,a){var e=e,a=a;e.blur(function(){var o=a.val(),c=e.val();if(o!=c){if(a.val(c),void 0==c||0==getStrLength(c))return $("#j-sava-btn").addClass("noclick").removeClass("click"),$("#nickname_fall").show().html("昵称不能为空"),void $("#j-success-icon").hide();var n=/^([0-9a-zA-Z]|[\u4E00-\u9FA5])*$/;if(!n.test(c))return $("#j-sava-btn").addClass("noclick").removeClass("click"),$("#nickname_fall").show().html("昵称只能包括中英文、数字"),void $("#j-success-icon").hide();ajax({url:"/api/account/checkNickname?nickname="+c}).done(function(){$("#j-success-icon").show(),$("#nickname_fall").hide(),$("#j-sava-btn").addClass("click").removeClass("noclick")},function(e){var a=e.responseText;try{var o=JSON.parse(a);30013==o.errorCode?($("#j-sava-btn").addClass("noclick").removeClass("click"),$("#nickname_fall").show().html("昵称已被霸占了，换个试试~"),$("#j-success-icon").hide()):30017==o.errorCode&&window.location.reload()}catch(c){}})}})},InfoUtil.setGradeName=function(){var e="#949494",a="#000";0==$("#j-grade-select-data").val()&&$("#j-grade-select").css("color",e),$("#j-grade-select option").css("color",a),$("#j-grade-select").change(function(){var o=$(this).val();o==$(this).find("option.default").val()?$(this).css("color",e):$(this).css("color",a),$(this).children(".default").remove()})},InfoUtil.getCollegeMajorDatas=function(e,a,o,c,n){var n=n;"college"==n?url="/api/user/getColleges?key="+e.val():"major"==n&&(url="/api/user/getMajors?key="+e.val()),ajax({url:url}).done(function(n){var l="";$.each(n.results,function(e,a){l+='<li class="choose_item"><span class="dataname">'+a+'</span><span class="hint">请选择</span></li>'}),l+='<li class="choose_item"><span class="dataname">其他</span><span class="hint">请选择</span></li>',o.html(l).show(),o.delegate(".choose_item","click",function(){var o=$(this),n=o.children(".dataname").html(),l=o.parent(".choose_list");l.hide(),e.val(n),c.val(n),a.hide()})},function(e){console.log("获取学校／专业失败");var a=e.responseText;try{var o=JSON.parse(a);30017==o.errorCode&&window.location.reload()}catch(c){}})},InfoUtil.modifyCollegeMajor=function(e,a,o,c,n){var l="info_input "+n;e.keyup(function(){""!=e.val()?(a.show(),InfoUtil.getCollegeMajorDatas(e,a,o,c,n)):a.hide()}).blur(function(){$("#j-main-con").click(function(n){var n=n||event,s=n.target||n.srcElement;s.className.toLowerCase()!=l&&"choose_item"!=s.className.toLowerCase()&&(e.val(c.val()),o.hide(),a.hide()),$("#j-main-con").unbind("click")})}),InfoUtil.emptyInput(e,a,o)},InfoUtil.emptyInput=function(e,a,o){a.click(function(){e.val(""),a.hide(),o.hide().html("")})},InfoUtil.choosePurpose=function(e){var a=e;a.click(function(){$(this).hasClass("cur")?$(this).removeClass("cur"):$(this).addClass("cur")})},InfoUtil.savaInfo=function(){var e=$("#j-check-ninkname").val(),a="请选择"==$("#j-grade-select option:selected").val()?"":$("#j-grade-select option:selected").val(),o=$("#j-check-college").val(),c=$("#j-check-major").val(),n="",l="";if($.each($(".purpose_item"),function(e,a){$(a).hasClass("cur")&&(n+=","+$(a).html())}),void 0==e||0==getStrLength(e))return $("#j-sava-btn").addClass("noclick").removeClass("click"),$("#nickname_fall").show().html("昵称不能为空"),void $("#j-success-icon").hide();var s=/^([0-9a-zA-Z]|[\u4E00-\u9FA5])*$/;return s.test(e)?(n=","==n[0]?n.substring(1):n,l="?nickname="+e+"&gradeName="+a+"&collegeName="+o+"&majorName="+c+"&objectives="+n,void ajax({url:"/api/user/info/add"+l}).done(function(){window.location.reload()},function(e){var a=e.responseText;try{var o=JSON.parse(a);30013==o.errorCode?($("#j-sava-btn").addClass("noclick").removeClass("click"),$("#nickname_fall").show().html("昵称已被霸占了，换个试试~"),$("#j-success-icon").hide()):30017==o.errorCode&&window.location.reload()}catch(c){}})):($("#j-sava-btn").addClass("noclick").removeClass("click"),$("#nickname_fall").show().html("昵称只能包括中英文、数字"),void $("#j-success-icon").hide())};